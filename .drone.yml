pipeline:
  # Render Homepage:
  #   image: corylogan/middleman-docker:latest
  #   pull: true
  #   commands:
  #     - cd homepage
  #     - bundle install --quiet
  #     - middleman build

  # Clone Blogs:
  #   image: indiehosters/git
  #   commands:

      # - git clone https://github.com/counterbeing/europe-trip-blog.git
      # - git clone https://github.com/counterbeing/south-america-blog.git

  # Build Europe Blog:
  #   image: node:8.1.2
  #   commands:
  #     - cd europe-trip-blog
  #     # - npm install -g ember-cli@2.14.1 --silent
  #     # - npm install --silent
  #     - yarn global add ember-cli@2.14.1 --silent
  #     - yarn --silent
  #     - ember build --environment="production"

  # Build South America Blog:
  #   image: node:6.11
  #   commands:
  #     - cd south-america-blog
  #     # - npm install -g ember-cli --silent
  #     - yarn global add ember-cli
  #     - yarn
  #     - ember build --prod

  # Render Hugo Tech Blog:
  #   image: corylogan/hugo-with-elinks:latest
  #   commands:
  #     - cd hugo_tech_blog
  #     - hugo

  # Copy Assets to Folder:
  #   image: alpine
  #   commands:
  #     # - cp -r homepage/build/* rendered_assets/
  #     # - cp -r hugo_tech_blog/public rendered_assets/bits
  #     # - cp -r europe-trip-blog/dist rendered_assets/eu
  #     # - cp -r south-america-blog/dist rendered_assets/sa
  #     - cp -r static/* ./
  #     - rm -rf ./static
  #     # - mv rendered_assets/* to somewhere


  Commit:
    image: indiehosters/git
    commands:
      - echo $TEST_SECRET
      # - eval $(ssh-agent -s)
      # - echo $GITHUB_PRIVATE_KEY >> tempfile && chmod 0600 tempfile
      # - ssh-add tempfile
      # - rm tempfile
      # - ssh-add -l
      - git config --global user.email "ci@drone.flirtmoji.co"
      - git config --global user.name "Drone Server"
      - git fetch origin
      - git checkout --track origin/gh-pages
      - echo 'ran' >> README.md
      - git add .
      - git commit -am 'build `date +"%d-%m-%Y"`'
      # - git push

  Git Push:
    image: appleboy/drone-git-push
    remote: git@github.com:counterbeing/homepage.git
    force: false
    commit: true
    branch: gh-pages
    local_ref: gh-pages
    secrets: [ GIT_PUSH_SSH_KEY ]


  # Build Sitemap:
  #   image: node:8.1.2
  #   commands:
  #     - cd rendered_assets
  #     - yarn global add sitemap-static minimal-sitemap --silent
  #     # - npm install -g sitemap-static minimal-sitemap --silent
  #     - sitemap-static --prefix=https://www.corylogan.com > ./partial.xml
  #     - combine_sitemaps ./partial.xml ./sa/sitemap.xml > ./sitemap.xml
  #
  # Build Site Image:
  #   image: plugins/docker
  #   dockerfile: Dockerfile
  #   repo: corylogan/homepage
  #   secrets: [ DOCKER_USERNAME, DOCKER_PASSWORD ]
  #   tags:
  #     - latest
  #     - ${DRONE_COMMIT_SHA:8}

  # Deploy To Kontena:
  #   image: kontena/cli
  #   secrets: [ KONTENA_GRID, KONTENA_TOKEN, KONTENA_URL ]
  #   commands:
  #     - SSL_IGNORE_ERRORS=true kontena stack deploy homepage

  # Submit sitemap to google:
  #   image: appropriate/curl
  #   commands:
  #     - curl http://google.com/ping?sitemap=https://www.corylogan.com/sitemap.xml
branches:
  - master
